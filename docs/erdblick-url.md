# URL Guide

Erdblick encodes the full UI state inside the browser URL. That makes it easy to bookmark views, send links to colleagues, or preconfigure visualization-only deployments.

## What Gets Stored in the URL?

- Camera state: latitude, longitude, altitude, and orientation (heading, pitch, roll) for each view.
- Number of map views, which view is focused, view sync flags (position/movement/projection/layers), and 2D/3D projection mode per view.
- Active maps and the complete layer matrix: which layers are visible in which view, their zoom levels, and whether tile borders are drawn.
- Base-map settings: OpenStreetMap overlay toggles and opacity per view.
- Enabled styles plus the values of all style options per map layer and view.
- Inspection state: open panels, pinned vs. unpinned selections, panel sizes and highlight colours, and any active SourceData selection.
- Search palette state and the last executed query.
- Tile budget limits from the Preferences dialog (tiles to load vs. tiles to visualise).
- Coordinate marker enablement and position.

The URL is pruned automatically so it never grows beyond a few kilobytes, even after extended sessions.

## URL Parameters Reference

The table below lists all query parameters used by erdblick when encoding or restoring UI state.

| Parameter | Scope | Description |
| --- | --- | --- |
| `n` | Global | Number of active map views (1 for single view, 2 for split view). |
| `lon`, `lat`, `alt` | Per view | Camera destination (degrees and meters). Values are encoded per view; with multiple views they are stored as colon-separated lists. |
| `h`, `p`, `r` | Per view | Camera orientation in radians (heading, pitch, roll), encoded in the same way as `lon`/`lat`/`alt`. |
| `m2d` | Per view | 2D projection mode flag for each view. |
| `f` | Global | Index of the focused view (0-based), which receives keyboard focus and search-driven camera moves. |
| `sync` | Global | Enabled view synchronisation flags. Contains a subset of `pos`, `mov`, `proj`, and `lay`. |
| `osm` | Per view | Base map overlay enablement for each view. |
| `osmOp` | Per view | Base map opacity (0–100), per view. |
| `l` | Global | Ordered list of map layer identifiers. Other layer-related parameters index into this list. |
| `v` | Per view | Layer visibility flags per view, aligned with the `l` list. |
| `tb` | Per view | Tile-border visibility flags per view, aligned with the `l` list. |
| `z` | Per view | Per-layer zoom level configuration per view, aligned with the `l` list. |
| `tll` | Global | Maximum number of tiles to load (Tiles to load). |
| `tvl` | Global | Maximum number of tiles to visualise (Tiles to visualize). |
| `s` | Global | Current search query, encoded as a view index plus query string. |
| `m` | Global | Coordinate marker enablement flag. |
| `mp` | Global | Coordinate marker position when enabled (longitude and latitude). |
| `sel` | Global | Encoded inspection panel state (panels, selections, sizes, and highlight colours). |
| `<styleId>~layers~options` | Per style | Style option parameters generated by the style system. See _Style Option Encoding in the URL_ for the exact encoding. |

!!! note "Manual URL editing is optional"
    You rarely need to edit query parameters directly. All values are updated automatically when you interact with the UI. The reference above is primarily useful when you need to construct or debug URLs programmatically.

## Visualization-Only Parameters

When running the visualization-only build or embedding erdblick without UI panels, use URL parameters to set the initial state:

| Parameter | Description |
| --- | --- |
| `lon`, `lat`, `alt` | Center position in degrees and altitude in meters. |
| `h`, `p`, `r` | Camera orientation (radians: heading, pitch, roll). |
| `osm` | Toggle the base map overlay (`true`/`false`), per view. |
| `osmOp` | Base map opacity in percent (0–100), per view. |
| `tll` | Maximum number of tiles to load, per view. |
| `tvl` | Maximum number of tiles to visualize, per view. |

Example:

```
http://localhost:8089/?lon=11.0454671&lat=48.0179306&alt=1000&h=0.5&p=-0.7&osm=true&osmOp=30&tll=1024&tvl=256
```

## Multi-View State in Query Parameters

When you enable split view, erdblick still encodes the full layout into the query string. A few points are useful when you inspect or hand-craft URLs:

- The `n` parameter records how many map views are active. A value of `1` means single view, `2` enables split screen.
- Camera and layer-related parameters are encoded per view. Internally, erdblick uses comma-separated lists for per-layer values and colon-separated groups for per-view values. This allows the same parameter to describe all views at once.
- View synchronisation flags (position, movement, projection, and layer sync) are part of the state. They decide whether updates from the focused view are propagated to the other view(s).
- The focused view index is stored so that URL replays preserve which pane responds to keyboard shortcuts and search-based camera moves.

You do not need to set these parameters manually for normal usage, but they make generated URLs stable even for complex multi-view layouts.

## Style Option Encoding in the URL

Style option values can vary by stylesheet, map layer, and view. To keep URLs compact, erdblick encodes all option values for a given style into a single query parameter whose name and value are structured strings:

- The **parameter name** has the form  
  `<short-style-id>~<dash-separated-layer-indices>~<tilde-separated-option-ids>`  
  where the layer indices refer to positions in the internal `layerNames` array.
- The **parameter value** is a sequence of `~`-separated bodies, one per option ID. Each body is a `:`-separated list of per-view strings, and each per-view string is a comma-separated list of values for the participating layers.

For example, a style with short ID `NY0X`, affecting three layers and three boolean options might produce a parameter like:

```text
NY0X~1-2-3~showLanes~showLaneGroups~ADAS=1,0,0:1,0,0~1,1,1:0,0,0~0,0,0:0,0,0
```

Here:

- `NY0X` identifies the stylesheet.
- `1-2-3` points at the affected entries in the `layerNames` array.
- `showLanes~showLaneGroups~ADAS` lists option identifiers.
- The value encodes, for each option in order, a pair of `view0,view1` arrays:
  - `1,0,0:1,0,0` – `showLanes` enabled for the first layer in both views, disabled for the others.
  - `1,1,1:0,0,0` – `showLaneGroups` enabled for all three layers in view 0, disabled in view 1.
  - `0,0,0:0,0,0` – `ADAS` disabled everywhere.

All option values are stored as `0`/`1` numbers (booleans) or plain numbers/strings, depending on the option type. Unknown layers or styles are ignored when a URL is replayed, so links remain reasonably robust across configuration changes.

## Sharing Links

To share a particular map configuration with others, first get the view into the desired state and then capture the URL:

1. Configure the map exactly as needed (activate sources, zoom, tweak styles).
2. Click the link icon at the bottom of the search panel or copy the browser URL directly.
3. Send the link. Recipients load the same camera, layer, and style state.

The browser’s Back and Forward buttons move between previously visited URL states. Erdblick treats these as full state transitions and hydrates the matching cameras, layer visibility, selections, and style options accordingly.

Keep a few guidelines in mind when preparing URLs for long-term use:

- Capture the URL after tiles finish loading so that linked users do not need to interact before the state replays.
- If the link should remain valid for a long time, avoid referencing temporary maps or styles that live only in your local config.
- For official documentation, paste the copied URL into Markdown as a reference for screenshots or tutorials.

## Troubleshooting URL State

If a copied URL does not restore the expected state, a few common issues are worth checking first:

- If a link no longer opens correctly, verify that the map IDs and style IDs referenced in the URL still exist.
- Clear the browser history or use an incognito window if the URL appears correct but the UI keeps loading an older state. Cached `localStorage` overrides may conflict with the encoded state.
- If a URL looks correct but loads an unexpected state, use the Preferences dialog to clear stored viewer properties and search history, then reload the link.
